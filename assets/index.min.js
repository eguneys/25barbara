class t{constructor(t){this.t=t}static i=(e,i,r,h,n)=>new t([s.i(e-h/2,i-n/2,r),s.i(e+h/2,i-n/2,r),s.i(e+h/2,i+n/2,r),s.i(e-h/2,i+n/2,r)]);static get unit(){return t.i(0,0,0,1,1)}get h(){return new Float32Array(this.t.flatMap((t=>t.u)))}get indices(){return new Uint16Array([1,0,3,1,3,2])}transform(s){return new t(this.t.map((t=>s.o(t))))}}class s{constructor(t,s,e){this.x=t,this.y=s,this.z=e}static i=(t,e,i)=>new s(t,e,i);static get unit(){return new s(1,1,1)}static get l(){return new s(0,0,0)}static get _(){return new s(0,-1,0)}static get m(){return new s(0,1,0)}static get left(){return new s(-1,0,0)}static get right(){return new s(1,0,0)}get u(){return[this.x,this.y,this.z]}get p(){return new s(1/this.x,1/this.y,1/this.z)}get inverse(){return new s(-this.x,-this.y,-this.z)}get v(){return new s(this.x/2,this.y/2,this.z/2)}get M(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.M)}get normalize(){return 0===this.length?s.l:new s(this.x,this.y,this.z).scale(1/this.length)}get clone(){return s.i(this.x,this.y,this.z)}A(t){return this.x*t.x+this.y*t.y+this.z*t.z}F(t){return s.i(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}k(t){return this.sub(t).length}scale(t){return s.i(this.x*t,this.y*t,this.z*t)}add(t){return s.i(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return s.i(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return s.i(this.x*t.x,this.y*t.y,this.z*t.z)}}class e{constructor(t){this.L=t}static i=t=>new e(t);static get identity(){return new e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}get clone(){return new e(this.L.slice(0))}static perspective=(t,s,i,r)=>{const h=Math.tan(.5*Math.PI-.5*t);let n=1/(i-r);return new e([h/s,0,0,0,0,h,0,0,0,0,(i+r)*n,-1,0,0,i*r*n*2,0])};static q=(t,s,i,r,h,n)=>new e([2*h/(r-i),0,0,0,0,2*h/(t-s),0,0,(r+i)/(r-i),(t+s)/(t-s),-(n+h)/(n-h),-1,0,0,-2*n*h/(n-h),0]);static D=(t,s,e,i)=>{let r=e*Math.tan(.5*t),h=2*r,n=s*h,a=-.5*n,u=a+n,o=r-h;return this.q(r,o,a,u,e,i)};static U=(t,s,i)=>{let r=t.sub(s).normalize,h=i.F(r).normalize,n=r.F(h).normalize;return e.i([...h.u,0,...n.u,0,...r.u,0,...t.u,1])};static C=t=>{let[s,i,r,h]=t.L,n=s+s,a=i+i,u=r+r,o=s*n,l=i*n,c=i*a,_=r*n,w=r*a,g=r*u,d=h*n,m=h*a,p=h*u;return e.i([1-c-g,l+p,_-m,0,l-p,1-o-g,w+d,0,_+m,w-d,1-o-c,0,0,0,0,1])};get inverse(){let[t,s,i,r,h,n,a,u,o,l,c,_,w,g,d,m]=this.L,[p,v,x,f,M,A,y,b,F,k,z,L]=[t*n-s*h,t*a-i*h,t*u-r*h,s*a-i*n,s*u-r*n,i*u-r*a,o*g-l*w,o*d-c*w,o*m-_*w,l*d-c*g,l*m-_*g,c*m-_*d],q=p*L-v*z+x*k+f*F-M*b+A*y;return q?(q=1/q,new e([(n*L-a*z+u*k)*q,(i*z-s*L-r*k)*q,(g*A-d*M+m*f)*q,(c*M-l*A-_*f)*q,(a*F-h*L-u*b)*q,(t*L-i*F+r*b)*q,(d*x-w*A-m*v)*q,(o*A-c*x+_*v)*q,(h*z-n*F+u*y)*q,(s*F-t*z-r*y)*q,(w*M-g*x+m*p)*q,(l*x-o*M-_*p)*q,(n*b-h*k-a*y)*q,(t*k-s*b+i*y)*q,(g*v-w*f-d*p)*q,(o*f-l*v+c*p)*q])):null}rotate(t){return this.mul(e.C(t))}scale(t){let s=this.L;return e.i([s[0]*t.x,s[1]*t.x,s[2]*t.x,s[3]*t.x,s[4]*t.y,s[5]*t.y,s[6]*t.y,s[7]*t.y,s[8]*t.z,s[9]*t.z,s[10]*t.z,s[11]*t.z,s[12],s[13],s[14],s[15]])}translate(t){let s=this.L.slice(0);return s[12]=s[0]*t.x+s[4]*t.y+s[8]*t.z+s[12],s[13]=s[1]*t.x+s[5]*t.y+s[9]*t.z+s[13],s[14]=s[2]*t.x+s[6]*t.y+s[10]*t.z+s[14],s[15]=s[3]*t.x+s[7]*t.y+s[11]*t.z+s[15],new e(s)}mul(t){let s=this.L.slice(0),[i,r,h,n,a,u,o,l,c,_,w,g,d,m,p,v]=s,[x,f,M,A,y,b,F,k,z,L,q,D,U,C,P,E]=t.L;return s[0]=x*i+f*a+M*c+A*d,s[1]=x*r+f*u+M*_+A*m,s[2]=x*h+f*o+M*w+A*p,s[3]=x*n+f*l+M*g+A*v,s[4]=y*i+b*a+F*c+k*d,s[5]=y*r+b*u+F*_+k*m,s[6]=y*h+b*o+F*w+k*p,s[7]=y*n+b*l+F*g+k*v,s[8]=z*i+L*a+q*c+D*d,s[9]=z*r+L*u+q*_+D*m,s[10]=z*h+L*o+q*w+D*p,s[11]=z*n+L*l+q*g+D*v,s[12]=U*i+C*a+P*c+E*d,s[13]=U*r+C*u+P*_+E*m,s[14]=U*h+C*o+P*w+E*p,s[15]=U*n+C*l+P*g+E*v,new e(s)}o(t){let e=this.L,[i,r,h]=t.u,n=e[3]*i+e[7]*r+e[11]*h+e[15];return n=n||1,s.i((e[0]*i+e[4]*r+e[8]*h+e[12])/n,(e[1]*i+e[5]*r+e[9]*h+e[13])/n,(e[2]*i+e[6]*r+e[10]*h+e[14])/n)}}class i{constructor(t){this.L=t}static i=t=>new i(t);static get identity(){return i.i([0,0,0,1])}P(t){t*=.5;let s=this.L.slice(0),e=Math.sin(t),r=Math.cos(t),[h,n,a,u]=s;return s[0]=h*r+u*e,s[1]=n*r+a*e,s[2]=a*r-n*e,s[3]=u*r-h*e,new i(s)}R(t){t*=.5;let s=this.L.slice(0),e=Math.sin(t),r=Math.cos(t),[h,n,a,u]=s;return s[0]=h*r-a*e,s[1]=n*r+u*e,s[2]=a*r+h*e,s[3]=u*r-n*e,new i(s)}S(t){t*=.5;let s=this.L.slice(0),e=Math.sin(t),r=Math.cos(t),[h,n,a,u]=s;return s[0]=h*r+n*e,s[1]=n*r-h*e,s[2]=a*r+u*e,s[3]=u*r-a*e,new i(s)}}function r(t,s,e){let i=t.createShader(s);return t.shaderSource(i,e),t.compileShader(i),i}class h{constructor(t,s,e,i){this.canvas=t,this.V=s,this.X=e,this.camera=i;let h=r(s,s.VERTEX_SHADER,"#version 300 es\nin vec4 a_pos;in vec2 a_tex;out vec2 v_tex;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*a_pos;v_tex=a_tex;}"),n=r(s,s.FRAGMENT_SHADER,"#version 300 es\nprecision highp float;in vec2 v_tex;uniform sampler2D u_texture;out vec4 out_color;void main(){vec4 t_color=texture(u_texture,v_tex);out_color=t_color;}"),a=s.createProgram();s.attachShader(a,h),s.attachShader(a,n),s.linkProgram(a),s.useProgram(a),this.Y=s.createVertexArray(),s.bindVertexArray(this.Y),this.Z=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.Z),s.bufferData(s.ARRAY_BUFFER,8e3,s.DYNAMIC_DRAW),this.j=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.j),s.bufferData(s.ELEMENT_ARRAY_BUFFER,2400,s.DYNAMIC_DRAW);let u=s.getAttribLocation(a,"a_pos");s.enableVertexAttribArray(u),s.vertexAttribPointer(u,3,s.FLOAT,!1,20,0);let o=s.getAttribLocation(a,"a_tex");s.enableVertexAttribArray(o),s.vertexAttribPointer(o,2,s.FLOAT,!1,20,12),s.bindVertexArray(null),this.B=s.getUniformLocation(a,"u_matrix"),this.G=s.createTexture(),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.G),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e.canvas),s.generateMipmap(s.TEXTURE_2D),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this.H=[];for(let r=0;r<2048;r+=256)for(let t=0;t<2048;t+=256)this.H.push([r,t])}get width(){return this.canvas.width}get height(){return this.canvas.height}I=[];Y;j;Z;G;B;get J(){return this.camera.K}H;N(){return this.H.shift()}O(t,s){this.H.push([t,s])}T(t,s){this.X.save(),this.X.translate(t,s),this.X.fillStyle="rgba(0, 0, 0, 0)",this.X.clearRect(0,0,256,256)}W(){this.X.restore()}$(t,s,e,i,r){i&&(this.X.fillStyle=i),r&&(this.X.strokeStyle=r),this.X.beginPath(),this.X.arc(t,s,e,0,2*Math.PI),this.X.closePath(),i&&this.X.fill(),r&&this.X.stroke()}path(t,s,e=1){let i=new Path2D(t);this.X.strokeStyle=s,this.X.lineWidth=e,this.X.stroke(i)}tt(t,r,h,n,a,u,o,l,c=1,_=c,w=c){let g=i.identity.P(t).R(r).S(h),d=e.identity.translate(s.i(n,a,u)).rotate(g).scale(s.i(64,64,64)).scale(s.i(c,_,w));this.I.push([d,o,l])}st(){this.V.uniformMatrix4fv(this.B,!1,this.J.L)}once(){this.V.viewport(0,0,1920,1080),this.V.clearColor(0,0,0,1),this.V.enable(this.V.DEPTH_TEST),this.V.enable(this.V.BLEND),this.V.blendFunc(this.V.ONE,this.V.ONE_MINUS_SRC_ALPHA),this.V.depthFunc(this.V.LEQUAL)}clear(){this.V.clear(this.V.COLOR_BUFFER_BIT|this.V.DEPTH_BUFFER_BIT)}draw(){let{V:e}=this;e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.G),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.X.canvas);let i=this.I.length,r=new Uint16Array(6*i),h=new Float32Array(5*i*4),n=0,a=0;this.I.sort(((t,e)=>{let i=e[0].o(s.l),r=t[0].o(s.l);return i.z===r.z?r.y-i.y:i.z-r.z})).forEach(((s,e)=>{let[i,u,o]=s,l=[u,o,u+256,o,u+256,o+256,u,o+256].map((t=>t/2048)),{h:c,indices:_}=t.unit.transform(i);for(let t=0;t<c.length;t+=3)h[n++]=c[t],h[n++]=c[t+1],h[n++]=c[t+2],h[n++]=l[t/3*2],h[n++]=l[t/3*2+1];for(let t=0;t<_.length;t++)r[a++]=4*e+_[t]})),this.st(),this.I=[],e.bindBuffer(e.ARRAY_BUFFER,this.Z),e.bufferSubData(e.ARRAY_BUFFER,0,h,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.j),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,r,0),e.bindVertexArray(this.Y),e.drawElements(e.TRIANGLES,6*i,e.UNSIGNED_SHORT,0)}}class n{constructor(t,s){this.et=t,this.it=s}get rt(){return this.ht.inverse??e.identity}get K(){return this.nt.clone.mul(this.rt)}nt=e.D(.25*Math.PI,16/9,10,1e3);get ht(){return e.U(this.et,this.it,s._)}}const a=function(){let t=new Set;return document.addEventListener("keydown",(s=>(s=>{"ArrowUp"!==s.key&&"ArrowDown"!==s.key||s.preventDefault(),t.add(s.key)})(s))),document.addEventListener("keyup",(s=>{return e=s.key,void t.delete(e);var e})),s=>[...t].includes(s)}(),u={ut:0,ot:.016,time:0,lt:0,ct(t,s=0){let{ot:e,time:i}=this;return Math.floor((i-s-e)/t)<Math.floor((i-s)/t)}};const o="#000000",l="#FFF1E8",c="#FF004D",_="#FFCCAA";function w(t,e,i){return new s(e.x*i+t.x*(1-i),e.y*i+t.y*(1-i),e.z*i+t.z*(1-i))}class g{constructor(t=s.l){this._t=t}get value(){return this._t}get x(){return this._t.x}wt(){return new g(s.i(this._t.x+u.ot,this._t.y+u.ot,this._t.z+u.ot))}gt(t,s){return new g(w(this._t,t._t,s))}}class d{constructor(t=s.l,e=s.l){this.position=t,this.dt=e}get value(){return this.position}wt(){let t=this.dt.clone,e=this.position.clone;return e=s.i(e.x+t.x*u.ot,e.y+t.y*u.ot,e.z+t.z*u.ot),t=s.i(.8*t.x,.8*t.y,.8*t.z),new d(e,t)}gt(t,s){return new d(w(this.position,t.position,s),w(this.dt,t.dt,s))}}class m{constructor(t,e,i=s.l,r=s.l,h=s.unit){this.g=t,this.vt=e,this.xt=this.vt.ft(new g),this.Mt=this.vt.ft(new d(i)),this.At=this.vt.ft(new d(r)),this.yt=this.vt.ft(new d(h))}xt;get _t(){return this.vt.bt(this.xt)}Mt;get transform(){return this.vt.bt(this.Mt)}set transform(t){this.vt.Ft(this.Mt),this.Mt=this.vt.ft(t)}At;get rotation(){return this.vt.bt(this.At)}set rotation(t){this.vt.Ft(this.At),this.At=this.vt.ft(t)}yt;get scale(){return this.vt.bt(this.yt)}set scale(t){this.vt.Ft(this.yt),this.yt=this.vt.ft(t)}get kt(){let{x:t,y:s,z:e}=this.zt;return i.identity.P(t).R(s).S(e)}get Lt(){return this.transform.value}get qt(){return this.parent===this?this.Lt:this.Lt.clone.add(this.parent.qt)}get Dt(){return this.rotation.value}get zt(){return this.parent===this?this.Dt:this.Dt.clone.add(this.parent.zt)}Ut;Ct(t){return this.Ut=t,this}Pt(t){return this.children.filter((s=>s instanceof t))}Et(t){return this.children.find((s=>s instanceof t))}Rt(t,e,i=s.l,r=s.l,h=s.unit){let n=new t(this.g,this.vt,i,r,h);return n.parent=this,n.Ct(e).init(),n}i(t,s={},e,i,r){let h=this.Rt(t,s,e,i,r);return this.children.push(h),h}parent=this;children=[];St;Vt;init(){return[this.St,this.Vt]=this.g.N(),this.Xt(),this}wt(){this.children.forEach((t=>t.wt())),this.Yt()}Zt(){this.jt(),this.children.forEach((t=>t.Zt()));let{St:t,Vt:s}=this;this.g.T(t,s),this.Ut.debug?this.Bt():this.Gt(),this.g.W();let{x:e,y:i,z:r}=this.qt,{x:h,y:n,z:a}=this.zt,{x:u,y:o,z:l}=this.scale.value;this.g.tt(h,n,a,e,i,r,t,s,u,o,l),this.Ht()}remove(){this.vt.Ft(this.Mt),this.vt.Ft(this.xt),this.children.forEach((t=>t.remove())),this.parent.children.splice(this.parent.children.indexOf(this),1),this.It()}Bt(){this.g.X.fillStyle="white",this.g.X.fillRect(0,0,256,256),this.g.path("M 0 0 L 0 100","red",10),this.g.path("M 128 128 L 100 100","green",10)}Xt(){}Yt(){}Gt(){}jt(){}Ht(){}It(){}}class p extends m{Zt(){this.jt(),this.children.forEach((t=>t.Zt())),this.Ht()}}class v extends m{Yt(){let t=a("ArrowUp")||a("w"),i=a("ArrowDown")||a("s"),r=a("ArrowLeft")||a("d"),h=a("ArrowRight")||a("a"),n=e.C(this.parent.kt).o(s.left).scale(15),u=e.C(this.parent.kt).o(s.right).scale(15),o=e.C(this.parent.kt).o(s._).scale(15),l=e.C(this.parent.kt).o(s.m).scale(15);r?this.transform.dt=this.transform.dt.add(n):h&&(this.transform.dt=this.transform.dt.add(u)),t?this.transform.dt=this.transform.dt.add(o):i&&(this.transform.dt=this.transform.dt.add(l))}Gt(){let{g:t}=this,s=2*Math.sin(4*this._t.x),e=128;t.path("M 188 128 A 1 1 0 0 0 188 68",o,10),t.path("M 68 68 A 1 1 0 0 0 68 128",o,10),t.path("M 188 68 A 1 1 0 0 0 68 68",o,10),t.$(e,168,40,c,o),t.$(e,108+s,64,c,o),this._t.x%3<2.3||this._t.x%3>2.6&&this._t.x%3<2.8?(t.path("M 98 98 L 98 108",l,20),t.path("M 158 98 L 158 108",l,20)):(t.path("M 88 108 L 108 108",l,20),t.path("M 148 108 L 168 108",l,20))}}class x extends m{Xt(){this.i(v,{},s.i(-100,0,-25),s.i(.25*Math.PI,0,0*Math.PI))}Gt(){let{g:t}=this;t.X.fillStyle=_,t.X.fillRect(0,0,256,256)}}class f extends p{Xt(){this.i(x,{},s.i(0,10,0),s.i(0,0,0),s.i(6,3,3))}Yt(){}jt(){this.g.clear()}Ht(){this.g.draw()}}class M{Jt;constructor(t){this.Jt=new f(t,this).Ct({}).init()}wt(){this.Jt.wt()}Zt(){this.Jt.Zt()}ft(t){return this.Kt.push(t)-1}Ft(t){this.Kt.splice(t,1)}bt(t){return this.Kt[t]}Kt=[]}function A(t){t.once(),function(t){let s;const e=i=>{let r=i-(s??i);for(r>25&&(r=25),s=i,u.ut+=r/1e3,t.wt();u.ut>=u.ot;)t.Kt=t.Kt.map((t=>t.wt())),u.time+=u.ot,u.ut-=u.ot;let h=t.Kt.map((t=>t.wt())),n=u.ut/u.ot,a=t.Kt.map(((t,s)=>t.gt(h[s],n))),o=t.Kt;t.Kt=a,t.Zt(),t.Kt=o,requestAnimationFrame(e)};requestAnimationFrame(e)}(new M(t))}!function(t){let e=function(t,e){let i=document.createElement("canvas"),r=i.getContext("webgl2",{antialias:!1,premultipliedAlpha:!1});const a=()=>{i.width=t,i.height=e};document.addEventListener("scroll",a,{capture:!0,passive:!0}),window.addEventListener("resize",a,{passive:!0}),a();let u=document.createElement("canvas"),o=u.getContext("2d");return u.width=2048,u.height=2048,o.imageSmoothingEnabled=!1,o.lineJoin="round",o.lineCap="round",new h(i,r,o,new n(s.i(0,70,-270),s.i(0,0,0)))}(1920,1080);t.appendChild(e.canvas),A(e)}(document.getElementById("app"));
