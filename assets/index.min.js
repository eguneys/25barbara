class t{constructor(t){this.t=t}static i=(i,e,r,h,n)=>new t([s.i(i,e-n,r),s.i(i+h,e-n,r),s.i(i+h,e,r),s.i(i,e,r)]);static get unit(){return t.i(0,0,0,1,1)}get h(){return new Float32Array(this.t.flatMap((t=>t.u)))}get indices(){return new Uint16Array([1,0,3,1,3,2])}transform(s){return new t(this.t.map((t=>s.l(t))))}}class s{constructor(t,s,i){this.x=t,this.y=s,this.z=i}static i=(t,i,e)=>new s(t,i,e);static get unit(){return new s(1,1,1)}static get o(){return new s(0,0,0)}static get _(){return new s(0,-1,0)}get u(){return[this.x,this.y,this.z]}get m(){return new s(1/this.x,1/this.y,1/this.z)}get inverse(){return new s(-this.x,-this.y,-this.z)}get p(){return new s(this.x/2,this.y/2,this.z/2)}get v(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.v)}get normalize(){return 0===this.length?s.o:new s(this.x,this.y,this.z).scale(1/this.length)}get clone(){return s.i(this.x,this.y,this.z)}M(t){return this.x*t.x+this.y*t.y+this.z*t.z}A(t){return s.i(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}k(t){return this.sub(t).length}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}}class i{constructor(t){this.q=t}static i=t=>new i(t);static get identity(){return new i([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}get clone(){return new i(this.q.slice(0))}static perspective=(t,s,e,r)=>{const h=Math.tan(.5*Math.PI-.5*t);let n=1/(e-r);return new i([h/s,0,0,0,0,h,0,0,0,0,(e+r)*n,-1,0,0,e*r*n*2,0])};static F=(t,s,e,r,h,n)=>new i([2*h/(r-e),0,0,0,0,2*h/(t-s),0,0,(r+e)/(r-e),(t+s)/(t-s),-(n+h)/(n-h),-1,0,0,-2*n*h/(n-h),0]);static U=(t,s,i,e)=>{let r=i*Math.tan(.5*t),h=2*r,n=s*h,a=-.5*n,u=a+n,l=r-h;return this.F(r,l,a,u,i,e)};static D=(t,s,e)=>{let r=t.sub(s).normalize,h=e.A(r).normalize,n=r.A(h).normalize;return i.i([...h.u,0,...n.u,0,...r.u,0,...t.u,1])};static P=t=>{let[s,e,r,h]=t.q,n=s+s,a=e+e,u=r+r,l=s*n,o=e*n,c=e*a,_=r*n,g=r*a,w=r*u,d=h*n,m=h*a,p=h*u;return i.i([1-c-w,o+p,_-m,0,o-p,1-l-w,g+d,0,_+m,g-d,1-l-c,0,0,0,0,1])};get inverse(){let[t,s,e,r,h,n,a,u,l,o,c,_,g,w,d,m]=this.q,[p,v,x,f,M,b,y,A,k,z,q,F]=[t*n-s*h,t*a-e*h,t*u-r*h,s*a-e*n,s*u-r*n,e*u-r*a,l*w-o*g,l*d-c*g,l*m-_*g,o*d-c*w,o*m-_*w,c*m-_*d],U=p*F-v*q+x*z+f*k-M*A+b*y;return U?(U=1/U,new i([(n*F-a*q+u*z)*U,(e*q-s*F-r*z)*U,(w*b-d*M+m*f)*U,(c*M-o*b-_*f)*U,(a*k-h*F-u*A)*U,(t*F-e*k+r*A)*U,(d*x-g*b-m*v)*U,(l*b-c*x+_*v)*U,(h*q-n*k+u*y)*U,(s*k-t*q-r*y)*U,(g*M-w*x+m*p)*U,(o*x-l*M-_*p)*U,(n*A-h*z-a*y)*U,(t*z-s*A+e*y)*U,(w*v-g*f-d*p)*U,(l*f-o*v+c*p)*U])):null}rotate(t){return this.mul(i.P(t))}scale(t){let s=this.q;return i.i([s[0]*t.x,s[1]*t.x,s[2]*t.x,s[3]*t.x,s[4]*t.y,s[5]*t.y,s[6]*t.y,s[7]*t.y,s[8]*t.z,s[9]*t.z,s[10]*t.z,s[11]*t.z,s[12],s[13],s[14],s[15]])}translate(t){let s=this.q;return s[12]=s[0]*t.x+s[4]*t.y+s[8]*t.z+s[12],s[13]=s[1]*t.x+s[5]*t.y+s[9]*t.z+s[13],s[14]=s[2]*t.x+s[6]*t.y+s[10]*t.z+s[14],s[15]=s[3]*t.x+s[7]*t.y+s[11]*t.z+s[15],this}mul(t){let s=this.q,[i,e,r,h,n,a,u,l,o,c,_,g,w,d,m,p]=s,[v,x,f,M,b,y,A,k,z,q,F,U,D,P,V,X]=t.q;return s[0]=v*i+x*n+f*o+M*w,s[1]=v*e+x*a+f*c+M*d,s[2]=v*r+x*u+f*_+M*m,s[3]=v*h+x*l+f*g+M*p,s[4]=b*i+y*n+A*o+k*w,s[5]=b*e+y*a+A*c+k*d,s[6]=b*r+y*u+A*_+k*m,s[7]=b*h+y*l+A*g+k*p,s[8]=z*i+q*n+F*o+U*w,s[9]=z*e+q*a+F*c+U*d,s[10]=z*r+q*u+F*_+U*m,s[11]=z*h+q*l+F*g+U*p,s[12]=D*i+P*n+V*o+X*w,s[13]=D*e+P*a+V*c+X*d,s[14]=D*r+P*u+V*_+X*m,s[15]=D*h+P*l+V*g+X*p,this}l(t){let i=this.q,[e,r,h]=t.u,n=i[3]*e+i[7]*r+i[11]*h+i[15];return n=n||1,s.i((i[0]*e+i[4]*r+i[8]*h+i[12])/n,(i[1]*e+i[5]*r+i[9]*h+i[13])/n,(i[2]*e+i[6]*r+i[10]*h+i[14])/n)}}class e{constructor(t){this.q=t}static i=t=>new e(t);static get identity(){return e.i([0,0,0,1])}V(t){t*=.5;let s=this.q,i=Math.sin(t),e=Math.cos(t),[r,h,n,a]=s;return s[0]=r*e+a*i,s[1]=h*e+n*i,s[2]=n*e-h*i,s[3]=a*e-r*i,this}X(t){t*=.5;let s=this.q,i=Math.sin(t),e=Math.cos(t),[r,h,n,a]=s;return s[0]=r*e-n*i,s[1]=h*e+a*i,s[2]=n*e+r*i,s[3]=a*e-h*i,this}Y(t){t*=.5;let s=this.q,i=Math.sin(t),e=Math.cos(t),[r,h,n,a]=s;return s[0]=r*e+h*i,s[1]=h*e-r*i,s[2]=n*e+a*i,s[3]=a*e-n*i,this}}function r(t,s,i){let e=t.createShader(s);return t.shaderSource(e,i),t.compileShader(e),e}class h{constructor(t,s,i,e){this.canvas=t,this.Z=s,this.$=i,this.camera=e;let h=r(s,s.VERTEX_SHADER,"#version 300 es\nin vec4 a_pos;in vec2 a_tex;out vec2 v_tex;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*a_pos;v_tex=a_tex;}"),n=r(s,s.FRAGMENT_SHADER,"#version 300 es\nprecision highp float;in vec2 v_tex;uniform sampler2D u_texture;out vec4 out_color;void main(){vec4 t_color=texture(u_texture,v_tex);out_color=t_color;}"),a=s.createProgram();s.attachShader(a,h),s.attachShader(a,n),s.linkProgram(a),s.useProgram(a),this.j=s.createVertexArray(),s.bindVertexArray(this.j),this.B=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.B),s.bufferData(s.ARRAY_BUFFER,8e3,s.DYNAMIC_DRAW),this.C=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.C),s.bufferData(s.ELEMENT_ARRAY_BUFFER,2400,s.DYNAMIC_DRAW);let u=s.getAttribLocation(a,"a_pos");s.enableVertexAttribArray(u),s.vertexAttribPointer(u,3,s.FLOAT,!1,20,0);let l=s.getAttribLocation(a,"a_tex");s.enableVertexAttribArray(l),s.vertexAttribPointer(l,2,s.FLOAT,!1,20,12),s.bindVertexArray(null),this.G=s.getUniformLocation(a,"u_matrix"),this.H=s.createTexture(),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.H),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,i.canvas),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this.I=[];for(let r=0;r<2048;r+=128)for(let t=0;t<2048;t+=128)this.I.push([r,t])}get width(){return this.canvas.width}get height(){return this.canvas.height}J=[];j;C;B;H;G;get K(){return this.camera.L}I;N(){return this.I.shift()}O(t,s){this.I.push([t,s])}R(t,s){this.$.save(),this.$.translate(t,s),this.$.fillStyle="rgba(0, 0, 0, 0)",this.$.clearRect(0,0,128,128)}S(){this.$.restore()}T(t,r,h,n,a,u,l,o,c=1,_=c,g=c){let w=e.identity.V(t).X(r).Y(h),d=i.identity.translate(s.i(n,a,u)).rotate(w).scale(s.i(128,128,0)).scale(s.i(c,_,g)).translate(s.i(-.5,.5,0));this.J.push([d,l,o])}W(){this.Z.uniformMatrix4fv(this.G,!1,this.K.q)}once(){this.Z.viewport(0,0,1920,1080),this.Z.clearColor(0,0,0,1),this.Z.enable(this.Z.DEPTH_TEST),this.Z.enable(this.Z.BLEND),this.Z.blendFunc(this.Z.SRC_ALPHA,this.Z.ONE_MINUS_SRC_ALPHA),this.Z.depthFunc(this.Z.LEQUAL)}clear(){this.Z.clear(this.Z.COLOR_BUFFER_BIT|this.Z.DEPTH_BUFFER_BIT)}draw(){let{Z:s}=this;s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.H),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,this.$.canvas);let i=this.J.length,e=new Uint16Array(6*i),r=new Float32Array(5*i*4),h=0,n=0;this.J.sort(((t,s)=>s[0].q[6]-t[0].q[6])).forEach(((s,i)=>{let[a,u,l]=s,o=[u+128,l,u,l,u,l+128,u+128,l+128].map((t=>t/2048)),{h:c,indices:_}=t.unit.transform(a);for(let t=0;t<c.length;t+=3)r[h++]=c[t],r[h++]=c[t+1],r[h++]=c[t+2],r[h++]=o[t/3*2],r[h++]=o[t/3*2+1];for(let t=0;t<_.length;t++)e[n++]=4*i+_[t]})),this.W(),this.J=[],s.bindBuffer(s.ARRAY_BUFFER,this.B),s.bufferSubData(s.ARRAY_BUFFER,0,r,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.C),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e,0),s.bindVertexArray(this.j),s.drawElements(s.TRIANGLES,6*i,s.UNSIGNED_SHORT,0)}}class n{constructor(t,s){this.tt=t,this.st=s}get it(){return this.et.inverse??i.identity}get L(){return this.rt.clone.mul(this.it)}rt=i.U(.5*Math.PI,16/9,10,1e3);get et(){return i.D(this.tt,this.st,s._)}}const a={ht:0,nt:.016,time:0,ut:0,lt(t,s=0){let{nt:i,time:e}=this;return Math.floor((e-s-i)/t)<Math.floor((e-s)/t)}};function u(t,s,i=a.nt){return t<s?Math.min(t+i,s):t>s?Math.max(t-i,s):t}function l(t,i,e){return new s(i.x*e+t.x*(1-e),i.y*e+t.y*(1-e),i.z*e+t.z*(1-e))}class o{constructor(t=s.o){this.ot=t}get value(){return this.ot}get x(){return this.ot.x}ct(){return new o(s.i(this.ot.x+a.nt,this.ot.y+a.nt,this.ot.z+a.nt))}_t(t,s){return new o(l(this.ot,t.ot,s))}}class c{constructor(t=s.o,i=s.o,e=s.o){this.position=t,this.gt=i,this.wt=e}get value(){return this.position}ct(){let t=this.wt.clone,s=this.gt.clone,i=this.position.clone;return i.x=i.x+s.x*a.nt+t.x*(a.nt*a.nt*.5),i.y=i.y+s.y*a.nt+t.y*(a.nt*a.nt*.5),i.z=i.z+s.z*a.nt+t.z*(a.nt*a.nt*.5),t.x=u(t.x,0,20*a.nt),t.y=u(t.y,0,20*a.nt),t.z=u(t.z,0,20*a.nt),s.x=.8*s.x+(this.wt.x+t.x)*(.5*a.nt),s.y=.8*s.y+(this.wt.y+t.y)*(.5*a.nt),s.z=.8*s.z+(this.wt.z+t.z)*(.5*a.nt),new c(i,s,t)}_t(t,s){return new c(l(this.position,t.position,s),l(this.gt,t.gt,s),l(this.wt,t.wt,s))}}class _{constructor(t,i,e=s.o,r=s.o,h=s.unit){this.g=t,this.dt=i,this.vt=this.dt.xt(new o),this.ft=this.dt.xt(new c(e)),this.Mt=this.dt.xt(new c(r)),this.bt=this.dt.xt(new c(h))}vt;get ot(){return this.dt.yt(this.vt)}ft;get transform(){return this.dt.yt(this.ft)}set transform(t){this.dt.At(this.ft),this.ft=this.dt.xt(t)}Mt;get rotation(){return this.dt.yt(this.Mt)}set rotation(t){this.dt.At(this.Mt),this.Mt=this.dt.xt(t)}bt;get scale(){return this.dt.yt(this.bt)}set scale(t){this.dt.At(this.bt),this.bt=this.dt.xt(t)}get kt(){return this.transform.value}get zt(){return this.parent===this?this.kt:this.kt.clone.add(this.parent.zt)}get qt(){return this.rotation.value}get Ft(){return this.parent===this?this.qt:this.qt.clone.add(this.parent.Ft)}Ut;Dt(t){return this.Ut=t,this}Pt(t){return this.children.filter((s=>s instanceof t))}Vt(t){return this.children.find((s=>s instanceof t))}Xt(t,i,e=s.o,r=s.o,h=s.unit){let n=new t(this.g,this.dt,e,r,h);return n.parent=this,n.Dt(i).init(),n}i(t,s={},i,e,r){let h=this.Xt(t,s,i,e,r);return this.children.push(h),h}parent=this;children=[];Yt;Zt;init(){return[this.Yt,this.Zt]=this.g.N(),this.$t(),this}ct(){this.children.forEach((t=>t.ct())),this.jt()}Bt(){this.Ct(),this.children.forEach((t=>t.Bt()));let{Yt:t,Zt:s}=this;this.g.R(t,s),this.Et(),this.g.S();let{x:i,y:e,z:r}=this.zt,{x:h,y:n,z:a}=this.Ft,{x:u,y:l,z:o}=this.scale.value;this.g.T(h,n,a,i,e,r,t,s,u,l,o),this.Gt()}remove(){this.dt.At(this.ft),this.dt.At(this.vt),this.children.forEach((t=>t.remove())),this.parent.children.splice(this.parent.children.indexOf(this),1),this.Ht()}$t(){}jt(){}Et(){}Ct(){}Gt(){}Ht(){}}class g extends _{$t(){}Et(){let{g:t}=this,s=this.ot.x;this.rotation.position.z=.1,t.$.fillStyle="gold",t.$.fillRect(0,0,20,20),t.$.beginPath(),t.$.arc(64,64,10+54*Math.abs(Math.sin(s)),0,2*Math.PI),t.$.fill()}}class w extends _{Et(){let{g:t}=this;t.$.fillStyle="white",t.$.fillRect(49,49,30,30)}}class d extends _{$t(){this.i(w,{},s.i(0,0,0),s.i(.39*-Math.PI,0,0))}Et(){let{g:t}=this;t.$.fillStyle=`hsl(${1/13*255} 75% 50%)`,t.$.fillRect(0,0,128,128)}}class m extends _{$t(){this.i(g),this.i(d,{},s.i(100,15,2),s.i(.35*Math.PI,0,0),s.i(2,1,1))}Ct(){this.g.clear()}Gt(){this.g.draw()}}class p{It;constructor(t){this.It=new m(t,this).Dt({}).init()}ct(){this.It.ct()}Bt(){this.It.Bt()}xt(t){return this.Jt.push(t)-1}At(t){this.Jt.splice(t,1)}yt(t){return this.Jt[t]}Jt=[]}function v(t){t.once(),function(t){let s;const i=e=>{let r=e-(s??e);for(r>25&&(r=25),s=e,a.ht+=r/1e3,t.ct();a.ht>=a.nt;)t.Jt=t.Jt.map((t=>t.ct())),a.time+=a.nt,a.ht-=a.nt;let h=t.Jt.map((t=>t.ct())),n=a.ht/a.nt,u=t.Jt.map(((t,s)=>t._t(h[s],n))),l=t.Jt;t.Jt=u,t.Bt(),t.Jt=l,requestAnimationFrame(i)};requestAnimationFrame(i)}(new p(t))}!function(t){let i=function(t,i){let e=document.createElement("canvas"),r=e.getContext("webgl2",{antialias:!1,premultipliedAlpha:!1});const a=()=>{e.width=t,e.height=i};document.addEventListener("scroll",a,{capture:!0,passive:!0}),window.addEventListener("resize",a,{passive:!0}),a();let u=document.createElement("canvas"),l=u.getContext("2d");return u.width=2048,u.height=2048,l.imageSmoothingEnabled=!1,new h(e,r,l,new n(s.i(0,0,100),s.o))}(1920,1080);t.appendChild(i.canvas),v(i)}(document.getElementById("app"));
